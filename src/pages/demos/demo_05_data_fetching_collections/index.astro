---
let posts = [];
try {
  // Use Astro.request.url to build the absolute URL for SSR compatibility
  const { origin } = new URL(Astro.request.url);
  const res = await fetch(`${origin}/api/posts.json`);
  posts = await res.json();
} catch (e) {
  posts = [];
}
---
<html>
  <head>
    <title>Data Fetching Demo</title>
    <link rel="stylesheet" href="/src/styles/global.css">
  </head>
  <body class="font-sans bg-slate-50 m-0 p-0">
    <div class="max-w-lg mx-auto mt-12 bg-white rounded-2xl shadow-lg shadow-black/5 px-8 py-10 text-center">
      <h1 class="text-blue-500 text-3xl mb-6 font-normal">Data Fetching Demo</h1>
      <div class="text-slate-500 text-lg mb-8">
        This demo fetches data from an API endpoint at runtime and displays it below.
      </div>
      <ul class="list-none p-0 mx-auto max-w-xs">
        {posts.length ? posts.map((post: { title: string }) => <li class="bg-slate-100 rounded-lg mb-4 px-4 py-4 text-lg shadow-sm shadow-black/5">{post.title}</li>) : <li class="bg-slate-100 rounded-lg mb-4 px-4 py-4 text-lg shadow-sm shadow-black/5">No posts found.</li>}
      </ul>
    </div>
  </body>
</html>
